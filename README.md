## ESP8266-Modbus

Простое ModBus-slave устройство на базе Arduino Wemos D1.  
Отвечает мастеру по трем первым регистрам в которых содержатся часы, минуты, секунда со старта устройства соответственно.  

### Порядок задания и проверки адреса:  

Загружаешь скетч в плату.   
* параметры модбас можно изменить в скетче:  

```с
#define MB_RATE 115200        // скорость обмена по модбас
#define MB_FC SERIAL_8E1      // параметры контроля передачи модбас
```

Открываешь Инструменты - Монитор порта (Ctrl+Shift+M).  
Настройки порта 9600 (8N1)  
Жмешь reset на плате.   
Побежит вначале загрузочный мусор, а потом надпись вида:  

```
Address device - 1  

Wait new adress  
* command for set new address: set-xxx (001-127)  
0...  1...  2...  3...  4...  5...    

```

`Adress device` - это текущий адрес устройства. читается из eeprom в которой может быть мусор.  Если мусор значением больше 127 его скинет в 0. Так что в первый раз задавать обязательно.  
0...5 это отсчет 5сек во время которых можно запрограммировать новый адрес.  
Адрес 1 задается командой set-001 и так далее до 127. Команду, естественно, можно написать в строке заранее.  

Если команда была верная, то появится надпись   
`New adress set - 1  `

Если команда была с неверным диапазоном, то появится надпись  
`New adress set - Error  `

Если команды set- вообще не поступило, то надпись будет   
`New address not selected  `

Дальше пишется эхо-debug, который возвращает ввод любых 10 последних символов в консоль.  
Если ничего не воодить, то он не появится.  

и в конце процедуры идет надпись   
`Start programm   `
с этого момента консоль переинициализируется на конфиг обмена по modbus.  

***Вместо "монитора порта" можно пользоваться любым суровым терминальником для железа, например cutecom.***
***Ванильные putty и minicom не подойдут по причине того, что ориентированы на приглашение для ввода.***

### Чтение 

на примере утилиты mbpool  

`mbpoll -a 1 -b 115200 -c 3 /dev/ttyUSB0`
